#+title: Table(複数Item)

SmartDox DSLを使って記述したモデルの
サンプル文書です。

文書でサンプルモデルの定義をします。
本来は文書中の仕様記述の文書は
定義するモデルに対するものになります。

しかし、この文書ではSmartDox DSLの記述例として
SmartDox DSL文法の説明を記述することにします。

* サンプル文書の目的

このサンプル文書は表を中心にしてクラス定義するサンプルです。

登場人物、道具、出来事の各エンティティの種別の下に
顧客、商品、購入といった具象エンティティを節として
定義します。

そして、それらの節の下に属性一覧または特性一覧として
エンティティの属性や関連を記述していきます。

ここまでは「バリュー」と同じですが、
このバリューを復帰値にしたサービスを
追加定義している点が異なります。

* 登場人物

** 顧客

IDの指定はありませんが、以下のルールで推測しています。

- 陽にID指定がない場合、先頭の属性の属性名が「id」(大文字可)で終わる場合はIDとみなす。

#+caption: 属性一覧
| 名前   | 型     | カラム  | SQL型        |
|--------+--------+---------+--------------|
| 顧客ID | token  | ID      | CHAR(16)     |
| 名前   | token  | NAME    | VARCHAR(64)  |
| 住所   | string | ADDRESS | VARCHAR(256) |

* 道具

** 商品

IDは、ID欄で指定しています。

#+caption: 属性一覧
| 名前   | 型    | ID | カラム | SQL型       |
|--------+-------+----+--------+-------------|
| 商品ID | token | ○ | ID     | CHAR(16)    |
| 名前   | token |    | NAME   | VARCHAR(32) |
| 定価   | money |    | PRICE  | LONG        |

* 出来事

** 購入

IDは、特性欄で指定しています。

購入イベントで、複数の購入項目を参照しています。
ここが「Table」との相違点になります。

#+caption: 特性一覧
| 特性 | 名前     | 型       | 多重度 | 派生        | カラム      | SQL型    |
|------+----------+----------+--------+-------------+-------------+----------|
| ID   | 購入ID   | token    |        |             | ID          | CHAR(16) |
| 属性 | 日付     | date     |        |             | DATE        | DATE     |
| 関連 | 顧客     | 顧客     | 1      |             | CUSTOMER_ID | CHAR(16) |
| 属性 | 顧客名   | token    |        | 顧客.名前   |             |          |

*** 合成

購入において購入した商品と個数の組を表現する
エンティティ「購入商品」を定義します。

**** 購入商品+

購入から購入商品への多重度は、節名「購入商品+」の「+」で記述しています。

多重度は「性質一覧」、「Properties」の表で記述する方法も可能です。

エンティティに対する合成は以下のいずれかのモデルになります。

- 登録済みのエンティティが存在しない場合 → エンティティの合成部品(ステレオタイプpart)
- すでにエンティティが登録済みの場合 → 各種エンティティ

エンティティの合成部品となった場合、RDBMSでは関連エンティティとして
実装されます。
このためIDの暗黙解決や自動生成は行われません。

#+caption: 特性一覧
| 特性 | 名前   | 型    | 多重度 | 派生        | カラム | SQL型 |
|------+--------+-------+--------+-------------+--------+-------|
| 関連 | 商品   | 購入  |      1 |             |        |       |
| 属性 | 数量   | int   |        |             | AMOUNT | INT   |
| 属性 | 商品名 | token |        | 商品.名前   |        |       |
| 属性 | 単価   | money |        | 商品.定価   |        |       |
| 属性 | 総額   | money |        | 数量 * 単価 |        |       |

* Service

** purchase

